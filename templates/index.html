<!-- templates/index.html -->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>建物データ分析ツール（Web版）</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div class="app">
    <header>
      <h1>建物データ分析ツール（Web版）</h1>
      <a href="/logout">ログアウト</a>
    </header>

    <section class="controls">
      <div class="row">
        <label for="x_col">X軸</label>
        <select id="x_col"></select>

        <label for="y_col">Y軸</label>
        <select id="y_col"></select>

        <label for="graph_type">表示</label>
        <select id="graph_type">
          <option>散布図</option>
          <option>ヒストグラム</option>
        </select>

        <label for="degree">近似次数</label>
        <select id="degree">
          <option>1</option>
          <option>2</option>
          <option>3</option>
        </select>

        <button id="update">更新</button>
      </div>

      <div class="row">
        <label>検索（建物名称）</label>
        <input id="search" placeholder="建物名称検索">

        <label>合計設備容量 [kVA] 範囲</label>
        <input id="cap_min" placeholder="MIN" class="small">
        <input id="cap_max" placeholder="MAX" class="small">

        <label>対数軸</label>
        <label><input type="checkbox" id="log_x"> X対数</label>
        <label><input type="checkbox" id="log_y"> Y対数</label>
        <label><input type="checkbox" id="grid" checked> グリッド</label>
      </div>

      <div class="row filters">
        <div class="filter-block">
          <div class="filter-title">建物用途</div>
          {% for u in usages %}
            <label><input type="checkbox" class="filter" data-key="建物用途" value="{{u}}" checked> {{u}}</label>
          {% endfor %}
        </div>

        <div class="filter-block">
          <div class="filter-title">発行目的</div>
          {% for p in purposes %}
            <label><input type="checkbox" class="filter" data-key="発行目的" value="{{p}}" checked> {{p}}</label>
          {% endfor %}
        </div>

        <div class="filter-block">
          <div class="filter-title">設計会社</div>
          {% for c in companies %}
            <label><input type="checkbox" class="filter" data-key="設計会社" value="{{c}}" checked> {{c}}</label>
          {% endfor %}
        </div>

        <div class="filter-block">
          <div class="filter-title">変圧器設置</div>
          {% for t in transformers %}
            <label><input type="checkbox" class="filter" data-key="変圧器の主な設置場所" value="{{t}}" checked> {{t}}</label>
          {% endfor %}
        </div>
      </div>
    </section>

    <section id="chart-area">
      <div id="chart" style="width:100%;height:600px;"></div>
      <div id="equation" class="equation"></div>
    </section>

    <footer>
      <small>Cloudのデータを利用します。データを取得できない場合はサンプルデータで動作します。</small>
    </footer>
  </div>

  <script>
    // サーバから埋め込まれたテンプレート変数を JS 側に受け渡し
    const SERVER = {
      columns: {{ columns|tojson }},
      usage_colors: {{ usage_colors|tojson }}
    };
  </script>

  <script src="/static/script.js"></script>
</body>
</html>
